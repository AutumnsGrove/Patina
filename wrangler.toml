name = "grove-backups"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Cron trigger: Every Sunday at 3:00 AM UTC
[triggers]
crons = ["0 3 * * 0"]

# ============================================
# Source D1 Databases (all 9 Grove databases)
# ============================================

[[d1_databases]]
binding = "GROVEAUTH_DB"
database_name = "groveauth"
database_id = "45eae4c7-8ae7-4078-9218-8e1677a4360f"

[[d1_databases]]
binding = "SCOUT_DB"
database_name = "scout-db"
database_id = "6a289378-c662-4c6a-9f1b-fa5296e03fa2"

[[d1_databases]]
binding = "GROVE_ENGINE_DB"
database_name = "grove-engine-db"
database_id = "a6394da2-b7a6-48ce-b7fe-b1eb3e730e68"

[[d1_databases]]
binding = "GROVEMUSIC_DB"
database_name = "grovemusic-db"
database_id = "e1e31ed2-3b1f-4dbd-9435-c9105dadcfa2"

[[d1_databases]]
binding = "LIBRARY_ENHANCER_DB"
database_name = "library-enhancer-db"
database_id = "afd1ce4c-618a-430a-bf0f-0a57647a388d"

[[d1_databases]]
binding = "AUTUMNSGROVE_POSTS_DB"
database_name = "autumnsgrove-posts"
database_id = "510badf3-457a-4892-bf2a-45d4bfd7a7bb"

[[d1_databases]]
binding = "AUTUMNSGROVE_GIT_STATS_DB"
database_name = "autumnsgrove-git-stats"
database_id = "0ca4036f-93f7-4c8a-98a5-5353263acd44"

[[d1_databases]]
binding = "GROVE_DOMAIN_JOBS_DB"
database_name = "grove-domain-jobs"
database_id = "cd493112-a901-4f6d-aadf-a5ca78929557"

[[d1_databases]]
binding = "YOUR_SITE_POSTS_DB"
database_name = "your-site-posts"
database_id = "86342742-7d34-486f-97f0-928136555e1a"

# ============================================
# Metadata Database (for backup tracking)
# ============================================

[[d1_databases]]
binding = "METADATA_DB"
database_name = "grove-backups-db"
database_id = "TODO_CREATE_THIS_DATABASE"
# Run: wrangler d1 create grove-backups-db
# Then update this ID with the output

# ============================================
# R2 Backup Storage
# ============================================

[[r2_buckets]]
binding = "BACKUPS"
bucket_name = "grove-backups"
# Run: wrangler r2 bucket create grove-backups

# ============================================
# Environment Variables
# ============================================

[vars]
RETENTION_WEEKS = "12"
ALERT_ON_SUCCESS = "false"
ALERT_ON_FAILURE = "true"

# Set via: wrangler secret put DISCORD_WEBHOOK_URL
# DISCORD_WEBHOOK_URL = ""
