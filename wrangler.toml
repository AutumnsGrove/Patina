name = "grove-patina"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# Cron Triggers
# ============================================
[triggers]
crons = [
  "0 3 * * *",   # Nightly backup at 3:00 AM UTC
  "0 4 * * 0"    # Weekly archive at 4:00 AM UTC Sunday
]

# ============================================
# Source D1 Databases (6 Grove databases)
# ============================================

[[d1_databases]]
binding = "GROVEAUTH_DB"
database_name = "groveauth"
database_id = "45eae4c7-8ae7-4078-9218-8e1677a4360f"

[[d1_databases]]
binding = "SCOUT_DB"
database_name = "scout-db"
database_id = "6a289378-c662-4c6a-9f1b-fa5296e03fa2"

[[d1_databases]]
binding = "GROVE_ENGINE_DB"
database_name = "grove-engine-db"
database_id = "a6394da2-b7a6-48ce-b7fe-b1eb3e730e68"

[[d1_databases]]
binding = "AUTUMNSGROVE_POSTS_DB"
database_name = "autumnsgrove-posts"
database_id = "510badf3-457a-4892-bf2a-45d4bfd7a7bb"

[[d1_databases]]
binding = "AUTUMNSGROVE_GIT_STATS_DB"
database_name = "autumnsgrove-git-stats"
database_id = "0ca4036f-93f7-4c8a-98a5-5353263acd44"

[[d1_databases]]
binding = "GROVE_DOMAIN_JOBS_DB"
database_name = "grove-domain-jobs"
database_id = "cd493112-a901-4f6d-aadf-a5ca78929557"

# ============================================
# Metadata Database (for backup tracking)
# ============================================

[[d1_databases]]
binding = "METADATA_DB"
database_name = "grove-patina-db"
database_id = "TODO_CREATE_THIS_DATABASE"
# Run: wrangler d1 create grove-patina-db
# Then update this ID with the output

# ============================================
# R2 Backup Storage
# ============================================

[[r2_buckets]]
binding = "BACKUPS"
bucket_name = "grove-patina"
# Run: wrangler r2 bucket create grove-patina

# ============================================
# Environment Variables
# ============================================

[vars]
DAILY_RETENTION_DAYS = "7"
WEEKLY_RETENTION_WEEKS = "12"
ALERT_ON_SUCCESS = "false"
ALERT_ON_FAILURE = "true"

# Set via: wrangler secret put WEBHOOK_URL
# WEBHOOK_URL = ""
